# {{ ansible_managed }}

---
services:
  node_exporter:
    image: "{{ node_exporter_docker_image }}"
    container_name: "{{ node_exporter_docker_container_name }}"
    restart: unless-stopped
    pid: host
    cap_add:
      - SYS_TIME
      - NET_RAW
    environment:
      TZ: "{{ node_exporter_docker_timezone }}"
    command:
      - '--log.level=info'
      - '--web.listen-address={{ node_exporter_docker_listen_addr }}:{{ node_exporter_docker_listen_port }}'
      - '--path.rootfs=/host'
{% for x in node_exporter_flags %}
      - '{{ x }}'
{% endfor %}
    volumes:
      - /:/host:ro,rslave
    network_mode: host
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
    logging:
      driver: "json-file"
      options:
        max-size: "8m"
